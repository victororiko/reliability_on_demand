<?xml version="1.0" encoding="utf-8"?>

<Workflows>
	<!-- https://xflow.microsoft.com/Workflows/Details/Rel.RIOD.Population.Daily.T4 -->
	<Workflow Name="Rel.RIOD.Population.Daily.T4"
			  Enabled="true"
			  Author ="cosreldata"
			  FolderName ="PlatformHealth.Reliability"
			  RecurrenceUnit="2"
			  RecurrenceAmount="1"
			  Start="2021-03-01T12:00:00"
			  Email="cosreldata@microsoft.com"
            >
		<ConfigBases>
			<ConfigBase Name="MissionControlBYODT4" File="MissionControlBYODT4.xml"/>
		</ConfigBases>
		<Parameters>
			<Parameter Name="__vc" Value="https://cosmos15.osdinfra.net/cosmos/asimov.partner.swat" />
			<Parameter Name="_scopePath" Value="$(CLUSTER_ROOT);$(CLUSTER_ROOT)/shares/asimov.prod.data/PublicPartner/Processed/Reliability/Resources/Scripts/Common;$(CLUSTER_ROOT)/shares/asimov.prod.data/Public/Resources/Latest/Asimov;$(CLUSTER_ROOT)/shares/asimov.prod.data/Public/Resources/Latest/Asimov/Schema;$(CLUSTER_ROOT)/shares/asimov.prod.data/Public/Resources/Latest/Asimov/Policy"/>
			<Parameter Name="_priority" Value="998"/>
			<Parameter Name="_customProperties" Value="JobOwner=swat.phd.rel"/>
			<Parameter Name="_tokenAllocation" Value="100"/>
		</Parameters>
		<Activities>
			<Activity Name="CensusDevices" ConfigBase="MissionControlBYODT4" Class="Microsoft.Xflow.Activities.Scope.T4RecurrentScopeActivityV3" CredentialName="ScopeJob.Asimov.Partner.Public">
				<Parameters>
					<Parameter Name="_script" Value="/shares/asimov.prod.data/PublicPartner/Processed/Reliability/RIOD/Resources/RIOD.Population.Daily.script.scopet4"/>
					<Parameter Name="_inputDayLookBack" Value="1"/>
					<Parameter Name="_inputMinBuildCutoff" Value="22000"/>
					<Parameter Name="_inputFilterExpression" Value=""/>
					<Parameter Name="_outputFolder" Value="/shares/asimov.prod.data/PublicPartner/Processed/Reliability/RIOD/Streams/Population/"/>
					<Parameter Name="_currentFolder" Value="/shares/asimov.prod.data/PublicPartner/Processed/Reliability/RIOD/Streams/Population/Current/"/>
					<Parameter Name="_dailyFolder" Value="/shares/asimov.prod.data/PublicPartner/Processed/Reliability/RIOD/Streams/Population/Daily/"/>
					<Parameter Name="_hourlyFolder" Value="/shares/asimov.prod.data/PublicPartner/Processed/Reliability/RIOD/Streams/Population/Hourly/"/>
					<Parameter Name="_outputStreamName" Value="RIOD.Devices.Population.ss"/>
					<Parameter Name="_inputOSBuildDefinitionFile" Value="/shares/asimov.prod.data/PublicPartner/Processed/Reliability/Resources/UnifiedSchema/UnifiedSchema.OS.Releases.json"/>
					<Parameter Name="_OSCadence" Value="Development;Development-Skip;Retail-CB"/>
					<Parameter Name="_applyUnifiedOSConfig" Value="yes"/>
					<Parameter Name="_debugOutput" Value="true"/>
					<Parameter Name="_devicesAllOSSelectStatement" Value="OSVersionFull,OSVersion,!string.IsNullOrWhiteSpace(BuildNumber) ? (int?)int.Parse(BuildNumber) : (int?)null AS BuildNumber,!string.IsNullOrWhiteSpace(BuildRevision) ? (int?)int.Parse(BuildRevision) : (int?)null AS RevisionNumber,(BuildBranch ?? string.Empty).ToLowerInvariant() AS BuildBranch,DeviceId,(LocalDeviceId ?? string.Empty) AS SqmId,DeviceFamily AS _DeviceFamily,IsTestLab,IsMSFTOwned,OEMName_Uncleaned AS OldOEMName,OEMModel AS MappingOEMModel,ExpId AS ExpIds,OSEdition AS SkuEdition,OSSkuId,LastUpdatedDate AS LastSeenEventDate,OSOOBEDateTime,OSInstallTypeId,OSInstallTypeName"/>
					<Parameter Name="_devicesMostRecentSelectStatement" Value="DeviceId,ProcessorModel,TotalPhysicalRAM,PrimaryDiskType,PrimaryDiskTypeName,ProcessorCores,ProcessorPhysicalCores,OEMModelBaseBoard,CommercialId,(FlightRing ?? string.Empty).ToLowerInvariant() AS FlightRing,FirmwareVersion,OSArchitecture,InternalSalesSegmentKey,ModelHierarchyId,VBSState,GenuineStateName,IsRetail,ISOCountryShortName,InstallationType,DeviceModelKey"/>
					<Parameter Name="_devicesSelectStatement" Value="daos.*,ProcessorModel,TotalPhysicalRAM,PrimaryDiskType,PrimaryDiskTypeName,ProcessorCores,ProcessorPhysicalCores,OEMModelBaseBoard,CommercialId,FlightRing,FirmwareVersion,OSArchitecture,InternalSalesSegmentKey,VBSState,GenuineStateName,IsRetail,ISOCountryShortName,InstallationType,(DeviceManufacturer ?? string.Empty) == string.Empty ? &quot;Unknown&quot;: DeviceManufacturer AS OEMName,(DeviceModelName ?? string.Empty) == string.Empty ? &quot;Unknown&quot; : (DeviceModelName ?? string.Empty).ToLowerInvariant().StartsWith(&quot;hp &quot;) ? DeviceModelName.Substring(3).Trim() : DeviceModelName AS OEMModel,OEMFamily,IsMDA,ROW_NUMBER() OVER(PARTITION BY DeviceId, BuildNumber, RevisionNumber ORDER BY LastSeenEventDate DESC) AS DevicePrevalence"/>
				</Parameters>
			</Activity>
		</Activities>
	</Workflow>
</Workflows>